% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/unmixing.R
\name{unmix_samples}
\alias{unmix_samples}
\title{Unmix Experimental Samples}
\usage{
unmix_samples(
  sample_dir = "samples",
  M = NULL,
  W = NULL,
  unmixing_matrix_file = file.path("spectrQC_outputs", "autounmix_controls",
    "scc_unmixing_matrix.csv"),
  method = "WLS",
  cytometer = "Aurora",
  output_dir = file.path("spectrQC_outputs", "unmix_samples"),
  write_fcs = TRUE
)
}
\arguments{
\item{sample_dir}{Directory containing experimental FCS files.}

\item{M}{Optional reference matrix (Markers x Detectors). Required for
dynamic unmixing methods (`"WLS"`, `"OLS"`, `"NNLS"`, `"AutoSpectral"`).}

\item{W}{Optional static unmixing matrix (Markers x Detectors). If supplied,
unmixing is performed using matrix multiplication with the transposed W.}

\item{unmixing_matrix_file}{Optional CSV path to a saved unmixing matrix.
Used when `W` is not supplied. By default this points to the matrix produced
by [autounmix_controls()]. In static mode, if `M` is not supplied,
spectrQC attempts to auto-load a paired reference matrix from the same
directory (for QC metrics).}

\item{method}{Unmixing method ("WLS", "OLS", "NNLS", or "AutoSpectral").}

\item{cytometer}{Cytometer name used when `method = "AutoSpectral"` (for example `"Aurora"`).}

\item{output_dir}{Directory to save unmixed FCS files.}

\item{write_fcs}{Logical; if `TRUE`, write unmixed FCS files to `output_dir`.}
}
\value{
A named list with one element per sample. Each element contains
  `data` (unmixed abundances + QC metrics when available) and `residuals`
  (detector residual matrix, `NULL` if no compatible reference matrix is available).
}
\description{
Unmix Experimental Samples
}
\examples{
args(unmix_samples)
\dontrun{
unmixed <- unmix_samples(
  sample_dir = "samples",
  unmixing_matrix_file = "spectrQC_outputs/autounmix_controls/scc_unmixing_matrix.csv",
  output_dir = "spectrQC_outputs/unmix_samples"
)
names(unmixed)
}
}
